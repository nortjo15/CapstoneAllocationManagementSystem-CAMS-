version: '3.8' # Use a recent Docker Compose file format

services:
  db:
    image: postgres:16-alpine # Use a recent, stable PostgreSQL image
    volumes:
      - db_data:/var/lib/postgresql/data # Persist database data
    environment:
      POSTGRES_DB: your_db_name          # Replace with your desired DB name
      POSTGRES_USER: your_db_user        # Replace with your desired DB user
      POSTGRES_PASSWORD: your_db_password # Replace with a strong password!
    ports:
      - "5432:5432" # Expose PostgreSQL port to host (optional for dev)
    healthcheck: # Health check to ensure DB is ready before Django connects
      test: ["CMD-SHELL", "pg_isready -U $$POSTGRES_USER -d $$POSTGRES_DB"]
      interval: 5s
      timeout: 5s
      retries: 5

  backend:
    build: ./backend # Build from the Dockerfile in the ./backend directory
    command: python manage.py runserver 0.0.0.0:8000 # Command to run Django
    volumes:
      - ./backend:/app # Mount your local backend code into the container for live updates
    ports:
      - "8000:8000" # Expose Django port to your host machine
    depends_on:
      db:
        condition: service_healthy # Ensure DB is healthy before starting backend
    environment:
      # These must match what's set in the 'db' service
      DB_NAME: your_db_name
      DB_USER: your_db_user
      DB_PASSWORD: your_db_password
      DB_HOST: db # This is the service name for the database in docker-compose
      DB_PORT: 5432
      # Add other Django settings/environment variables here
      DJANGO_SETTINGS_MODULE: your_project_name.settings # Replace with your actual settings module

  frontend:
    build: ./frontend # Build from the Dockerfile in the ./frontend directory
    volumes:
      - ./frontend:/app # Mount frontend code for development (useful if you modify the Dockerfile to run dev server)
      # For production build, typically you don't need to mount code
    ports:
      - "80:80" # Expose Nginx port (for serving built Vue app) to your host
      # During development, you might run the Vue dev server separately (e.g. on 8080)
      # and not use Nginx in development, but this setup serves the *built* app.
      # If you want to use the Vue dev server in a container:
      # command: npm run dev # Change Dockerfile to expose 3000 or 8080
      # ports:
      #   - "8080:8080" # Map Vue dev server port
    depends_on:
      - backend # Frontend doesn't strictly depend on backend for *starting*, but it's good practice
                # if you anticipate API calls right away.

volumes:
  db_data: # Define the named volume for PostgreSQL data persistence