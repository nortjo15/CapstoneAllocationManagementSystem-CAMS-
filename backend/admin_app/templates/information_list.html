{% extends "admin_base.html" %}
{% load static %}

{% block page_header %}
<h1 class="h3 mb-0">Communications to Students</h1>
{% endblock %}

{% block page_toolbar %}
<div class="d-flex gap-2">
  <a href="{% url 'admin_app:information_create' %}" class="btn btn-primary">+ New Communication</a>
  <a href="{% url 'admin_app:section_list' %}" class="btn btn-outline-secondary">Manage sections</a>
</div>
{% endblock %}

{% block filter_bar %}
<form class="row g-2 align-items-center" method="get" role="search" aria-label="Filter information">
  <div class="col-auto">
    <label for="q" class="visually-hidden">Search</label>
    <input id="q" type="text" name="q" class="form-control"
           placeholder="Search title/body/author" value="{{ request.GET.q }}">
  </div>
  <div class="col-auto">
    <label for="section" class="visually-hidden">Section</label>
    <select id="section" name="section" class="form-select">
      <option value="">All sections</option>
      {% for s in sections %}
        <option value="{{ s.id }}" {% if request.GET.section == s.id|stringformat:"s" %}selected{% endif %}>{{ s.name }}</option>
      {% endfor %}
    </select>
  </div>
  <div class="col-auto">
    <label for="status" class="visually-hidden">Status</label>
    <select id="status" name="status" class="form-select">
      <option value=""          {% if current_status == "" %}selected{% endif %}>Any status</option>
      <option value="draft"     {% if current_status == "draft" %}selected{% endif %}>Draft</option>
      <option value="published" {% if current_status == "published" %}selected{% endif %}>Published</option>
      <option value="archived"  {% if current_status == "archived" %}selected{% endif %}>Archived</option>
    </select>
  </div>
  <div class="col-auto">
    <button class="btn btn-outline-secondary" type="submit">Apply</button>
  </div>
</form>
{% endblock %}

{% block content %}
<div class="card">
  <div class="card-body p-0">
    {% if items %}
    <div class="table-responsive">
      <table class="table table-striped table-hover table-sm mb-0">
        <thead>
          <tr>
            <th scope="col">Title</th>
            <th scope="col">Section</th>
            <th scope="col">Pinned</th>
            <th scope="col">Priority</th>
            <th scope="col">Published</th>
            <th scope="col">Expires</th>
            <th scope="col">Status</th>
            <th scope="col" class="text-end">Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for a in items %}
          <tr class="{% if a.expired_flag %}expired-row{% endif %}">
            <td>
              {{ a.title }}
              {% if a.expired_flag %}
                <span class="badge text-bg-danger ms-2">Expired</span>
              {% endif %}
            </td>
            <td>{{ a.section_id.name }}</td>
            <td>{{ a.pinned }}</td>
            <td>{{ a.priority }}</td>
            <td>{{ a.published_at|date:"Y-m-d H:i" }}</td>
            <td>{% if a.expires_at %}{{ a.expires_at|date:"Y-m-d H:i" }}{% else %}-{% endif %}</td>
            <td>{{ a.status }}</td>
            <td class="text-end">
              <a href="{% url 'admin_app:information_edit' a.id %}" class="btn btn-sm btn-outline-primary">Edit</a>
              <a href="{% url 'admin_app:information_delete' a.id %}" class="btn btn-sm btn-outline-danger">Delete</a>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    {% else %}
      <div class="p-4 text-center">No communication content found.</div>
    {% endif %}
  </div>
</div>
{% endblock %}

{% block pagination %}
{% if page %}
<nav class="mt-3" aria-label="Information pagination">
  <ul class="pagination mb-0">
    {% if page.has_previous %}
      <li class="page-item">
        <a class="page-link" href="?q={{ request.GET.q }}&section={{ request.GET.section }}&status={{ request.GET.status }}&page={{ page.previous_page_number }}">Previous</a>
      </li>
    {% else %}
      <li class="page-item disabled"><span class="page-link">Previous</span></li>
    {% endif %}
    <li class="page-item disabled"><span class="page-link">Page {{ page.number }} of {{ page.paginator.num_pages }}</span></li>
    {% if page.has_next %}
      <li class="page-item">
        <a class="page-link" href="?q={{ request.GET.q }}&section={{ request.GET.section }}&status={{ request.GET.status }}&page={{ page.next_page_number }}">Next</a>
      </li>
    {% else %}
      <li class="page-item disabled"><span class="page-link">Next</span></li>
    {% endif %}
  </ul>
</nav>
{% endif %}
{% endblock %}
